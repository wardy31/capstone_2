{"ast":null,"code":"import * as tf from '@tensorflow/tfjs-core';\nfunction getCenterCoordinatesAndSizesLayer(x) {\n  var vec = tf.unstack(tf.transpose(x, [1, 0]));\n  var sizes = [tf.sub(vec[2], vec[0]), tf.sub(vec[3], vec[1])];\n  var centers = [tf.add(vec[0], tf.div(sizes[0], tf.scalar(2))), tf.add(vec[1], tf.div(sizes[1], tf.scalar(2)))];\n  return {\n    sizes: sizes,\n    centers: centers\n  };\n}\nfunction decodeBoxesLayer(x0, x1) {\n  var _a = getCenterCoordinatesAndSizesLayer(x0),\n    sizes = _a.sizes,\n    centers = _a.centers;\n  var vec = tf.unstack(tf.transpose(x1, [1, 0]));\n  var div0_out = tf.div(tf.mul(tf.exp(tf.div(vec[2], tf.scalar(5))), sizes[0]), tf.scalar(2));\n  var add0_out = tf.add(tf.mul(tf.div(vec[0], tf.scalar(10)), sizes[0]), centers[0]);\n  var div1_out = tf.div(tf.mul(tf.exp(tf.div(vec[3], tf.scalar(5))), sizes[1]), tf.scalar(2));\n  var add1_out = tf.add(tf.mul(tf.div(vec[1], tf.scalar(10)), sizes[1]), centers[1]);\n  return tf.transpose(tf.stack([tf.sub(add0_out, div0_out), tf.sub(add1_out, div1_out), tf.add(add0_out, div0_out), tf.add(add1_out, div1_out)]), [1, 0]);\n}\nexport function outputLayer(boxPredictions, classPredictions, params) {\n  return tf.tidy(function () {\n    var batchSize = boxPredictions.shape[0];\n    var boxes = decodeBoxesLayer(tf.reshape(tf.tile(params.extra_dim, [batchSize, 1, 1]), [-1, 4]), tf.reshape(boxPredictions, [-1, 4]));\n    boxes = tf.reshape(boxes, [batchSize, boxes.shape[0] / batchSize, 4]);\n    var scoresAndClasses = tf.sigmoid(tf.slice(classPredictions, [0, 0, 1], [-1, -1, -1]));\n    var scores = tf.slice(scoresAndClasses, [0, 0, 0], [-1, -1, 1]);\n    scores = tf.reshape(scores, [batchSize, scores.shape[1]]);\n    var boxesByBatch = tf.unstack(boxes);\n    var scoresByBatch = tf.unstack(scores);\n    return {\n      boxes: boxesByBatch,\n      scores: scoresByBatch\n    };\n  });\n}","map":{"version":3,"mappings":"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","names":["tf","getCenterCoordinatesAndSizesLayer","x","vec","unstack","transpose","sizes","sub","centers","add","div","scalar","decodeBoxesLayer","x0","x1","div0_out","mul","exp","add0_out","div1_out","add1_out","stack","outputLayer","boxPredictions","classPredictions","params","tidy","batchSize","shape","boxes","reshape","tile","extra_dim","scoresAndClasses","sigmoid","slice","scores","boxesByBatch","scoresByBatch"],"sourceRoot":"","sources":["../../../src/ssdMobilenetv1/outputLayer.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}